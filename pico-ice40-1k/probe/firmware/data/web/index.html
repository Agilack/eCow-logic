<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
 <head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type"></meta>
  <meta content="utf-8" http-equiv="encoding"></meta>
  <link rel="stylesheet" href="/p/styl.css"></link>
  <script type="text/javascript">
  function PTabSel(num) {
    // Hide all content of primary tabs
    var tabs = document.getElementsByClassName("ptab");
    for(var i = 0; i < tabs.length; i++) {
      tabs[i].classList.remove("focus");
    }
    // Clear selection on sidebar icons
    var icons = document.getElementsByClassName("menu");
    for(var i = 0; i < icons.length; i++) {
      icons[i].classList.remove("selected");
    }

    // Set focus on selected side icon
    var selico = document.getElementById("menu_" + num);
    selico.classList.add("selected");
    // Show the selected primary tab
    var e = document.getElementById("ptab_" + num);
    e.classList.add("focus");
  };
  </script>
 </head>
 <body>
  <div id="topbar">
    <div class="title">eCow-logic</div>
  </div>
	<div id="sidebar">
		<div id="menu_1" class="menu selected">
			<a href="#" onclick="PTabSel(1); return false;">
			<i class="sprite" id="home"></i>
			</a>
		</div>
		<div id="menu_2" class="menu">
			<a href="#" onclick="PTabSel(2); return false;">
			<i class="sprite" id="rand"></i>
			</a>
		</div>
		<div id="menu_3" class="menu">
			<a href="#" onclick="PTabSel(3); return false;">
			<i class="sprite" id="cloud"></i>
			</a>
		</div>
		<div id="menu_4" class="menu">
			<a href="#" onclick="PTabSel(4); return false;">
			<i class="sprite" id="qust"></i>
			</a>
		</div>
	</div>
	<div id="content">
    <div class="ptab focus" id="ptab_1">
    <div style="float:right">
        <i class="sprite" id="logo"></i>
    </div>
    <div class="panel">
      <div class="phead">Charger un bitstream</div>
      <div class="pbody">
        <form action="/pld" method="POST" enctype="multipart/form-data">
        <label>Fichier </label><input type="file" name="bit" accept="">
        <br/>
        <input type="submit" class="button" value="Envoyer"/>
        </form>
      </div>
    </div>
    </div> <!-- ptab 1 -->
		<div class="ptab" id="ptab_2">
			<div class="panel">
				<div class="phead">Commande SPI</div>
				<div class="pbody">
					<input id="formSpiValue" type="text" name="cmd" size="40">
					<br/>
					<button id="formSpiButton" class="button">Envoyer</button>
				</div>
			</div>
			<div class="panel" id="spiDataPane" style="display: none">
				<div class="phead">Log des transactions</div>
				<div class="pbody">
					<pre id="spiDataLog"></pre>
				</div>
			</div>
		</div> <!-- ptab 2 -->

		<div class="ptab" id="ptab_3">
			<div class="panel">
				<div class="phead">Editeur de code</div>
				<div class="pbody">
					<div id="cloudInfoLayer" class="cloudLayer focus">
						<p>CowLab est un &eacute;diteur de code en ligne qui vous permet de d&eacute;velopper sur votre carte sans avoir &agrave; installer de logiciel sur votre ordinateur.</p>
						<button id="cloudStart"	class="button">Acceder &agrave; l'&eacute;diteur</button>
					</div>
				</div>
			</div>
		</div> <!-- ptab 3 -->
		
		<div class="ptab" id="ptab_4">
			<p>Documentation bientot disponible</p>
		</div> <!-- ptab 4 -->
	</div> <!-- content -->
  <script type="text/javascript">
  document.getElementById("formSpiButton").addEventListener("click", function () {
  	console.log("Form Spi Button");
  	var spival = document.getElementById('formSpiValue').value;
  	
  	document.getElementById("spiDataPane").style.display = "block";
  	var datalog = document.getElementById("spiDataLog");
  	datalog.innerHTML += "TX: " + spival + "\n";
  	
  	var args = "data=" + spival;
  	
  	var uri = '/spi';
  	
  	var xhr = new XMLHttpRequest();
  	xhr.open('post', uri, true);
  	xhr.onreadystatechange = function () {
  		if (xhr.readyState === 4) {
  			if(xhr.status == 200) {
	  			var result = "RX: " + xhr.response + "\n";
	  			datalog.innerHTML += result;
  			}
  		}
  	};
  	xhr.send(args);
  });
  document.getElementById("cloudStart").addEventListener("click", function () {
  	var scr = document.createElement('script');
  	scr.type  = 'text/javascript';
  	scr.async = true;
  	scr.src   = 'https://cow.tools/ecl/ide.js';
  	document.getElementsByTagName('head')[0].appendChild(scr);
  	console.log(scr.readyState);
	scr.onload = function () {
		console.log("Loaded");
	}
  	
  	var tabs = document.getElementsByClassName("cloudLayer");
  	for(var i = 0; i < tabs.length; i++) {
		tabs[i].classList.remove("focus");
        }
        
  });
  </script>
 </body>
</html>